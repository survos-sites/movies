{# Generated automatically from JSONL profile + Meilisearch settings.
   Safe to edit; re-generating will overwrite. #}
{% set _config = {"primaryKey":"id","titleField":"title","descriptionField":null,"imageField":"image_url","scalarFields":[],"tagFields":[],"maxLen":180,"maxList":6} %}

{% set pk        = attribute(hit, _config.primaryKey|default('id')) ?? (hit.id ?? null) %}
{% set titleKey  = _config.titleField|default('title') %}
{% set descKey   = _config.descriptionField|default(null) %}
{% set imageKey  = _config.imageField|default(null) %}

{# Resolve title with highlight if present #}
{% set highlightedTitle = (hit._highlightResult is defined
    and attribute(hit._highlightResult, titleKey) is defined
    and attribute(attribute(hit._highlightResult, titleKey), 'value') is defined)
    ? attribute(attribute(hit._highlightResult, titleKey), 'value')
    : null
%}

{% set title = highlightedTitle is not null
    ? highlightedTitle
    : (attribute(hit, titleKey) ?? (hit.title ?? pk))
%}

{# Resolve description with highlight if present #}
{% set description = null %}
{% if descKey %}
    {% set highlightedDesc = (hit._highlightResult is defined
        and attribute(hit._highlightResult, descKey) is defined
        and attribute(attribute(hit._highlightResult, descKey), 'value') is defined)
        ? attribute(attribute(hit._highlightResult, descKey), 'value')
        : null
    %}
    {% set rawDesc = attribute(hit, descKey) ?? null %}
    {% set description = highlightedDesc ?? rawDesc %}
{% endif %}

{% set imageUrl = imageKey ? (attribute(hit, imageKey) ?? null) : null %}

<div class="card h-100 shadow-sm border-0">
    {% if imageUrl %}
        <img
            src="{{ imageUrl }}"
            alt="{{ title|striptags }}"
            class="card-img-top"
            loading="lazy"
            decoding="async"
            style="max-height:200px;object-fit:cover;"
        >
    {% endif %}

    <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-start gap-2 mb-2">
            <h5 class="card-title mb-0 text-wrap" style="word-break:break-word;">
                {{ title|raw }}
            </h5>

            {# First scalar field as a badge, if any #}
            {% set scalarFields = _config.scalarFields|default([]) %}
            {% if scalarFields|length > 0 %}
                {% set sf = scalarFields[0] %}
                {% set sfVal = attribute(hit, sf)|default(null) %}
                {% if sfVal is not null %}
                    <span class="badge bg-primary-subtle text-primary-emphasis">
                        {{ sfVal }}
                    </span>
                {% endif %}
            {% endif %}
        </div>

        {% if description %}
            {% set text = description|striptags %}
            {% if text|length > _config.maxLen|default(180) %}
                {% set text = text|slice(0, _config.maxLen|default(180)) ~ 'â€¦' %}
            {% endif %}
            <p class="card-text text-body-secondary mb-3">
                {{ text|raw }}
            </p>
        {% endif %}

        {# Tag badges from tag fields #}
        {% set tagFields = _config.tagFields|default([]) %}
        {% if tagFields|length > 0 %}
            <div class="d-flex flex-wrap gap-1 small mb-2">
                {% for tf in tagFields %}
                    {% set v = attribute(hit, tf)|default(null) %}
                    {% if v is iterable %}
                        {% for item in v|slice(0, _config.maxList|default(6)) %}
                            <span class="badge bg-light text-body-secondary">{{ item }}</span>
                        {% endfor %}
                    {% elseif v is not null %}
                        <span class="badge bg-light text-body-secondary">
                            {{ v }}
                        </span>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="card-footer bg-transparent border-0 d-flex justify-content-between align-items-center flex-wrap gap-2">
        {% if pk is not null %}
            <span class="small text-body-secondary">ID: {{ pk }}</span>
        {% endif %}

        {# Do NOT modify: this is the JSON debug modal trigger used by insta_controller #}
        <button
            {{ stimulus_action(globals._sc_modal, 'modal') }}
            data-hit-id="{{ pk }}"
            class="btn btn-sm btn-outline-primary d-inline-flex align-items-center gap-1"
            title="View JSON details">
            {{ ux_icon('json')|raw }}
            <span class="ms-1">Details</span>
        </button>
    </div>
</div>